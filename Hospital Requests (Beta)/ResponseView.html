<html>

    <head>
        <title></title>
        <link rel="stylesheet" href="bootstrap.min.css">
        <script type="text/javascript" src="KASClient.js"></script>
        <script type="text/javascript" src="react.min.js"></script>
        <script type="text/javascript" src="jquery.min.js"></script>
        <link rel="stylesheet" href="datepicker.min.css" type="text/css">
        <script type="text/javascript" src="datepicker.min.js"></script>
        <script type="text/javascript" src="datepicker.en.js"></script>

		<style>
			.inline{
				display:flex;
				flex-direction:row;
				justify-content:flex-start;
			}
			body{
				background: url("bg_pattern.png");
				background:cover;
			}
            ul>li{
                margin-bottom: 10px;
            }
            .btn-primary{
                background-color: ##001994 !important;
                border: 1px solid ##001994 !important;
            }
            .btn-primary:hover{
                color: ##001994 !important;
                background-color: #81B9FF !important;
            }
		</style>
        <script>
            var _form; // type: KASForm
            var _myFormResponses; // type: KASFormResponse[]
            var _data = JSON.parse("{}");
            _data.requestType = "-1";
            _data.fullname = "-1";
            _data.passportNo = "-1";
            _data.exitDate = "-1";
            _data.reentryDate = "-1";
            _data.date = "-1";
            _data.employeeId = "-1";
            _data.reason = "-1";
            _data.photo = "-1";
            _data.visaNo = "-1";
            _data.issueDate = "-1";
            _data.expiryDate = "-1";

            // Below will be called on onload of ResponseView.html
            function onResponsePageLoad() {
                KASClient.Form.getFormAsync(function (form, error) {
                    if (error != null) {
                        KASClient.App.showNativeErrorMessage("Error");
                        return;
                    }
                    _form = form;

                    // Document title would be the form title
                    // document.getElementById("title").innerHTML = _form.title;

                    KASClient.Form.getMyFormResponsesAsync(function (responses, error) {
                        if (error != null) {
                            KASClient.App.showNativeErrorMessage("Resource Fetch error");
                            return;
                        }
                        _myFormResponses = responses;

                        // Render previous response, if any
                        if (isCurrentUserResponded()) {
                        }
                    });
                });
            }

            function submitData() {
                // var selectedOption = getSelectedOption();
                // var remark = document.getElementById("description").value;
                submitFormResponse(_data);
            }

            // Below will be called when responder submits a new response
            function submitFormResponse(data) {
                var status = true;
                if (data == null || data == "") {
                    KASClient.App.showNativeErrorMessage("Please fill remark");
                    status = false;
                }
                if(data.requestType == 'LR'){
                    if(data.fullname =='-1' || data.date == '-1' || data.employeeId == '-1' || data.reason == '-1' || data.photo == '-1'){
                        KASClient.App.showNativeErrorMessage("Please fill all details to book an appointment.");
                        status = false;
                    }
                }
                if(data.requestType == 'VR'){
                    if(data.fullname == '-1' || data.employeeId == '-1' || data.visaNo == '-1' || data.issueDate == '-1' || data.expiryDate == '-1'){
                        KASClient.App.showNativeErrorMessage("Please fill all details to request medical history.");
                        status = false;
                    }
                }
                if(data.requestType == 'ER'){
                    if(data.fullname == '-1' || data.passportNo == '-1' || data.exitDate == '-1' || data.reentryDate == '-1'){
                        KASClient.App.showNativeErrorMessage("Please fill all details to Request doctor's feedback.");
                        status = false;
                    }
                }
                if(status==true){
                    // For submitting response a question-answer
                    // map is required, lets create that!
                    var questionToAnswerMap = JSON.parse("{}");
                    // questionToAnswerMap[0] = selectedOption;
                    // questionToAnswerMap[1] = remark;
                    questionToAnswerMap[0] ="-1";
                    questionToAnswerMap[1] ="-1";
                    questionToAnswerMap[2] =_data.requestType;
                    questionToAnswerMap[3] = _data.fullname;
                    questionToAnswerMap[4] = _data.passportNo;
                    questionToAnswerMap[5] = _data.exitDate;
                    questionToAnswerMap[6] = _data.reentryDate;
                    questionToAnswerMap[7] = _data.date;
                    questionToAnswerMap[8] = _data.employeeId;
                    questionToAnswerMap[9] = _data.reason;
                    questionToAnswerMap[10] = _data.photo;
                    questionToAnswerMap[11] = _data.visaNo;
                    questionToAnswerMap[12] = _data.issueDate;
                    questionToAnswerMap[13] = _data.expiryDate;

                    var responseId = null;
                    var isEditingPreviousResponse = false;

                    // If there is a previous response, update it
                    if (isCurrentUserResponded()) {
                        responseId = _myFormResponses[0].id;
                        isEditingPreviousResponse = true;
                    }

                    // Finally submit the response
                    KASClient.Form.sumbitFormResponse(questionToAnswerMap, responseId, isEditingPreviousResponse);
                }
            }

            function isCurrentUserResponded() {
                return _myFormResponses && _myFormResponses.length > 0;
            }
        </script>
    </head>

    <body onload="onResponsePageLoad()">
        <br/> <br/>
        <!-- <div>
            <h1 id="title" style="text-align: center;padding: 20px;">HR Systems</h1>
        </div> -->
        <div>
            <br/> <br/>
            <script type="text/javascript">

            </script>
            <div>
                <div class="container">
                    <div class="row" id="reset" style="margin-bottom: 20px;">
                        <div class="col">
                            <button class="btn btn-block btn-danger" onclick="(function(){hideAll();$('#choice').show();})()">RESET</button>
                        </div>
                    </div>
                    <div class="row" id="choice">
                        <div class="col">
                            <div class="card" style="box-shadow: 0px 0px 7px #ccc;border:none;">
                                <h1 class="card-header" style="text-align: center;border-bottom: none;background-color: #81B9FF;">V2 Regional Hospital</h1>
                                <div class="card-body">
                                    <p>Choose your Request:</p>
                                    <ul style="list-style: none;margin-left: 0px;padding-left: 0px;">
                                        <li><button onclick="showLeaveRequest()" class="btn btn-primary btn-block">Book An Appointment</button></li>
                                        <li><button onclick="showVisaRequest()" class="btn btn-primary btn-block">Request Medical History</button></li>
                                        <li><button onclick="showExitReentry()" class="btn btn-primary btn-block">Request Doctor's Feedback</button></li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="row" id="leave-request" style="margin-bottom: 20px;">
                        <div class="col">
                            <div class="card" style="box-shadow: 0px 0px 7px #ccc;border:none;">
                                <h3 class="card-header" style="text-align: center;border-bottom: none;background-color: #81B9FF;">Book An Appointment</h3>
                                <div class="card-body">
                                    <ul style="list-style: none;margin-left: 0px;padding-left: 0px;">
                                       <div class="form-group">
                                           <label for="l-full-name">Patient Name</label>
                                           <input class="form-control" oninput="(function(e){
                                                _data.fullname = document.getElementById('l-full-name').value;
                                                console.log(JSON.stringify(_data));
                                            })()" type="text" id="l-full-name">
                                       </div>
                                       <div class="form-group">
                                           <label for="l-date">Appointment Date</label>
                                           <input class="form-control datepicker-here" data-language='en' oninput="(function(e){
                                                _data.date = document.getElementById('l-date').value;
                                                console.log(JSON.stringify(_data));
                                            })()" type="text" id="l-date" readonly>
                                       </div>
                                       <div class="form-group">
                                           <label for="l-employee-id">Insurance No.</label>
                                           <input class="form-control" oninput="(function(e){
                                                _data.employeeId = document.getElementById('l-employee-id').value;
                                                console.log(JSON.stringify(_data));
                                            })()" type="text" id="l-employee-id">
                                       </div>
                                       <div class="form-group">
                                           <label for="l-reason">Medical Condition</label>
                                           <input class="form-control" oninput="(function(e){
                                                _data.reason = document.getElementById('l-reason').value;
                                                console.log(JSON.stringify(_data));
                                            })()" type="text" id="l-reason">
                                       </div>
                                       <div class="form-group">
                                        <img src="" width="150" height="150" alt="Photo" id="thumbnail" style="margin-bottom: 20px;">
                                           <button class="btn btn-block btn-light" id="l-photo">Attach ID</button>
                                       </div>
                                       <div class="form-group">
                                           <button class="btn btn-primary btn-block" onclick="submitData()">BOOK</button>
                                       </div>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="row" id="visa-request" style="margin-bottom: 20px;">
                        <div class="col">
                            <div class="card" style="box-shadow: 0px 0px 7px #ccc;border:none;">
                                <h3 class="card-header" style="text-align: center;border-bottom: none;background-color: #81B9FF;">Request Medical History</h3>
                                <div class="card-body">
                                    <ul style="list-style: none;margin-left: 0px;padding-left: 0px;">
                                       <div class="form-group">
                                           <label for="v-full-name">Patient Name</label>
                                           <input class="form-control" oninput="(function(e){
                                                _data.fullname = document.getElementById('v-full-name').value;
                                                console.log(JSON.stringify(_data));
                                            })()" type="text" id="v-full-name">
                                       </div>
                                        <div class="form-group">
                                           <label for="v-employee-id">Phone Number</label>
                                           <input class="form-control" oninput="(function(e){
                                                _data.employeeId = document.getElementById('v-employee-id').value;
                                                console.log(JSON.stringify(_data));
                                            })()" type="text" id="v-employee-id">
                                       </div>
                                       <div class="form-group">
                                           <label for="v-visa-no">Home Address</label>
                                           <input class="form-control" oninput="(function(e){
                                                _data.visaNo = document.getElementById('v-visa-no').value;
                                                console.log(JSON.stringify(_data));
                                            })()" type="text" id="v-visa-no">
                                       </div>

                                       <div class="form-group">
                                           <label for="v-issue-date">Patient DOB</label>
                                           <input class="form-control datepicker-here" data-language='en' oninput="(function(e){
                                                _data.issueDate = document.getElementById('v-issue-date').value;
                                                console.log(JSON.stringify(_data));
                                            })()" type="text" id="v-issue-date" readonly>
                                       </div>
                                       <div class="form-group">
                                           <label for="v-expiry-date">Report ENDING Date</label>
                                           <input type="text" oninput="(function(e){
                                                _data.expiryDate = document.getElementById('v-expiry-date').value;
                                                console.log(JSON.stringify(_data));
                                            })()" class="form-control datepicker-here" data-language='en' id="v-expiry-date" readonly>
                                       </div>
                                       <div class="form-group">
                                           <button class="btn btn-primary btn-block" onclick="submitData()">SUBMIT</button>
                                       </div>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="row" id="exit-request" style="margin-bottom: 20px;display: none;">
                        <div class="col">
                            <div class="card" style="box-shadow: 0px 0px 7px #ccc;border:none;">
                                <h3 class="card-header" style="text-align: center;border-bottom: none;background-color: #81B9FF;">Request Doctor's Feedback</h3>
                                <div class="card-body">
                                    <ul style="list-style: none;margin-left: 0px;padding-left: 0px;">
                                       <div class="form-group">
                                           <label for="e-full-name">Patient Name</label>
                                           <input class="form-control" oninput="(function(e){
                                                _data.fullname = document.getElementById('e-full-name').value;
                                                console.log(JSON.stringify(_data));
                                            })()" type="text" id="e-full-name">
                                       </div>
                                        <div class="form-group">
                                           <label for="e-passport-no">Phone Number</label>
                                           <input class="form-control" oninput="(function(e){
                                                _data.passportNo = document.getElementById('e-passport-no').value;
                                                console.log(JSON.stringify(_data));
                                            })()" type="text" id="e-passport-no">
                                       </div>
                                       <div class="form-group">
                                           <label for="e-exit-date">Patient DOB</label>
                                           <input class="form-control datepicker-here" oninput="(function(e){
                                                _data.exitDate = document.getElementById('e-exit-date').value;
                                                console.log(JSON.stringify(_data));
                                            })()" type="text" data-language='en' id="e-exit-date" readonly>
                                       </div>

                                       <div class="form-group">Date of Visit</label>
                                           <label for="e-reentry-date"></label>
                                           <input class="form-control datepicker-here" oninput="(function(e){
                                                _data.reentryDate = document.getElementById('e-reentry-date').value;
                                                console.log(JSON.stringify(_data));
                                            })()" type="text" data-language='en' id="e-reentry-date" readonly>
                                       </div>
                                       <div class="form-group">
                                           <button class="btn btn-primary btn-block" id="e-submit" onclick="submitData()">SUBMIT</button>
                                       </div>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <br/> <br/>
            <div>
        </div>
        <script type="text/javascript">
                function getBase64(file){
                    let reader = new FileReader();
                    let fileData='';
                    reader.readAsDataURL(file);
                    reader.onload = function(){
                        _data.photo = reader.result;
                    }
                    reader.onerror = function(e){
                        _data.photo = '';
                    }
                }

                function hideAll(){
                    $('#leave-request').hide();
                    $('#visa-request').hide();
                    $('#exit-request').hide();
                    $('#reset').hide();
                }

                function showLeaveRequest(){
                    _data.requestType = "LR";
                    $('#choice').hide();
                    $('#leave-request').show(3);
                    $('#reset').show(3);
                }

                function showVisaRequest(){
                    _data.requestType = "VR";
                    _data.photo="";
                    $('#choice').hide();
                    $('#visa-request').show(3);
                    $('#reset').show(3);
                }

                function showExitReentry(){
                    _data.requestType = "ER";
                    _data.photo="";
                    $('#choice').hide();
                    $('#exit-request').show(3);
                    $('#reset').show(3);
                }

                function reset(){
                    _data.photo = "";
                    hideAll();
                    $('#choice').show();
                }

                hideAll();
                document.getElementById('v-issue-date').addEventListener('focusout',function(){
                    _data.issueDate = document.getElementById('v-issue-date').value;
                });
                document.getElementById('v-expiry-date').addEventListener('focusout',function(){
                    _data.expiryDate = document.getElementById('v-expiry-date').value;
                });
                document.getElementById('e-exit-date').addEventListener('focusout',function(){
                    _data.exitDate = document.getElementById('e-exit-date').value;
                });
                document.getElementById('e-reentry-date').addEventListener('focusout',function(){
                    _data.reentryDate = document.getElementById('e-reentry-date').value;
                });
                document.getElementById('l-date').addEventListener('focusout',function(){
                    _data.date = document.getElementById('l-date').value;
                });
                document.getElementById('l-photo').addEventListener('click',function(){
                    // KASClient.App.showImagePickerAsync(function(selectedImagePath,error){
                    //     if(error != null){
                    //         KASClient.App.showNativeErrorMessage("Please select a valid photo");
                    //     }else{
                    //         // KASClient.App.showNativeErrorMessage(JSON.stringify(selectedImagePath));

                    //         KASClient.App.generateBase64ThumbnailAsync(selectedImagePath, function (thumbnail, error) {
                    //             if (error == null && thumbnail != null) {
                    //             //use the thumbnail data and update required dom
                    //                 _data.photo = 'data:image/png;base64,'+thumbnail;
                    //                 document.getElementById("thumbnail").src = 'data:image/png;base64,'+thumbnail;
                    //                 $('#thumbnail').show();
                    //                 _data.photo = selectedImagePath;
                    //             }
                    //         });

                    //     }
                    // })
                    var props = JSON.parse('{}');
                    props[KASClient.KASAttachmentListQuestionConfig.MAX_IMAGE_COUNT_KEY]=1;

                    KASClient.App.showAttachmentPickerAsync([KASClient.KASAttachmentType.Image],props,function(selectedAttachments,error){
                        if (error != null) {
                      return;
                        }
                        if (selectedAttachments && selectedAttachments.length > 0) {
                            var selectedImagePath = selectedAttachments[0].localPath;
                            KASClient.App.generateBase64ThumbnailAsync(selectedImagePath, function (thumbnail, error) {
                                if (error == null && thumbnail != null) {
                                //use the thumbnail data and update required dom
                                    _data.photo = 'data:image/png;base64,'+thumbnail;
                                    document.getElementById("thumbnail").src = 'data:image/png;base64,'+thumbnail;
                                    $('#thumbnail').show();
                                    _data.photo = selectedImagePath;
                                }
                            });
                        }
                        })
                })
        </script>
    </body>

    </html>
